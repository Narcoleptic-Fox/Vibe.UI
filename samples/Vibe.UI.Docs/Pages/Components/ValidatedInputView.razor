@page "/components/validatedinput"
@using Vibe.UI.Components

<PageTitle>ValidatedInput - Vibe.UI</PageTitle>

<div class="max-w-4xl">
    <!-- Header -->
    <header class="mb-8">
        <div class="flex items-center gap-2 text-sm text-zinc-500 mb-2">
            <a href="/" class="hover:text-zinc-700 dark:hover:text-zinc-300">Docs</a>
            <span>/</span>
            <a href="/components" class="hover:text-zinc-700 dark:hover:text-zinc-300">Components</a>
            <span>/</span>
            <span class="text-zinc-900 dark:text-zinc-100">ValidatedInput</span>
        </div>
        <h1 class="text-3xl font-bold text-zinc-900 dark:text-zinc-100 mb-3">ValidatedInput</h1>
        <p class="text-lg text-zinc-600 dark:text-zinc-400">
            An input component with built-in validation display and error handling.
        </p>
    </header>

    <!-- Preview Section -->
    <section class="mb-12">
        <h2 class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4">Preview</h2>
        <div class="p-8 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg border border-zinc-200 dark:border-zinc-700">
            <div style="display: flex; flex-direction: column; gap: 2rem; max-width: 600px;">
                <div>
                    <h4 class="text-base font-medium text-zinc-800 dark:text-zinc-200 mb-3">With Custom Validation</h4>
                    <ValidatedInput @bind-Value="@username"
                                    Label="Username"
                                    Placeholder="Enter username (min 3 chars)"
                                    Validator="@ValidateUsername"
                                    HelperText="Only letters, numbers, and underscores allowed"
                                    ValidateOnInput="true" />
                </div>

                <div>
                    <h4 class="text-base font-medium text-zinc-800 dark:text-zinc-200 mb-3">Email Validation</h4>
                    <ValidatedInput @bind-Value="@email"
                                    InputType="email"
                                    Label="Email"
                                    Placeholder="you@example.com"
                                    Validator="@ValidateEmail"
                                    ValidateOnBlur="true" />
                </div>

                <div>
                    <h4 class="text-base font-medium text-zinc-800 dark:text-zinc-200 mb-3">Password Strength</h4>
                    <ValidatedInput @bind-Value="@password"
                                    InputType="password"
                                    Label="Password"
                                    Placeholder="Enter password"
                                    Validator="@ValidatePassword"
                                    HelperText="At least 8 characters required"
                                    ValidateOnInput="true" />
                    @if (!string.IsNullOrEmpty(password))
                    {
                        <p class="text-sm mt-2 text-brand-teal">Strength: @passwordStrength</p>
                    }
                </div>

                <div>
                    <h4 class="text-base font-medium text-zinc-800 dark:text-zinc-200 mb-3">Required Field</h4>
                    <ValidatedInput @bind-Value="@fullName"
                                    Label="Full Name"
                                    Placeholder="Enter your full name"
                                    Required="true"
                                    ValidateOnBlur="true" />
                </div>
            </div>
        </div>
    </section>

    <!-- Examples Section -->
    <section class="mb-12">
        <h2 class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-6">Examples</h2>

        <!-- Basic Usage -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-3">Basic Usage</h3>
            <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                Use with EditForm and DataAnnotationsValidator for automatic validation.
            </p>
            <CodeBlock Code="@BasicCode" Language="razor" />
        </div>

        <!-- With Data Annotations -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-3">With Data Annotations</h3>
            <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                Leverage .NET data annotations for model validation.
            </p>
            <CodeBlock Code="@DataAnnotationsCode" Language="razor" />
        </div>

        <!-- Custom Validation -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-3">Custom Validation</h3>
            <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                Implement custom validation logic with validator functions.
            </p>
            <CodeBlock Code="@CustomValidationCode" Language="razor" />
        </div>

        <!-- Real-time Validation -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-3">Real-time Validation</h3>
            <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                Validate input as the user types for immediate feedback.
            </p>
            <CodeBlock Code="@RealtimeCode" Language="razor" />
        </div>

        <!-- Multiple Validators -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-3">Multiple Validators</h3>
            <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                Combine data annotations with custom validators.
            </p>
            <CodeBlock Code="@MultipleValidatorsCode" Language="razor" />
        </div>
    </section>

    <!-- API Reference -->
    <section class="mb-12">
        <h2 class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-6">API Reference</h2>

        <!-- Properties -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-4">Properties</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-zinc-200 dark:border-zinc-700">
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Name</th>
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Type</th>
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Default</th>
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Description</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-zinc-100 dark:divide-zinc-800">
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">Value</td>
                            <td class="py-3 px-4"><TypeBadge Type="TValue" /></td>
                            <td class="py-3 px-4 text-zinc-500">default</td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">The input value</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">For</td>
                            <td class="py-3 px-4"><TypeBadge Type="Expression<Func<T>>" /></td>
                            <td class="py-3 px-4 text-zinc-500">null</td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">Expression identifying the bound field</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">ValidationMode</td>
                            <td class="py-3 px-4"><TypeBadge Type="ValidationMode" /></td>
                            <td class="py-3 px-4 text-zinc-500">OnSubmit</td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">When to trigger validation (OnChange, OnBlur, OnSubmit)</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">CustomValidator</td>
                            <td class="py-3 px-4"><TypeBadge Type="Func<TValue, string>" /></td>
                            <td class="py-3 px-4 text-zinc-500">null</td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">Custom validation function</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">ShowValidationIcon</td>
                            <td class="py-3 px-4"><TypeBadge Type="bool" /></td>
                            <td class="py-3 px-4 text-zinc-500">true</td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">Whether to show validation status icon</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">Label</td>
                            <td class="py-3 px-4"><TypeBadge Type="string?" /></td>
                            <td class="py-3 px-4 text-zinc-500">null</td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">Label text</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Events -->
        <div class="mb-8">
            <h3 class="text-lg font-medium text-zinc-800 dark:text-zinc-200 mb-4">Events</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-zinc-200 dark:border-zinc-700">
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Name</th>
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Type</th>
                            <th class="text-left py-3 px-4 font-medium text-zinc-900 dark:text-zinc-100">Description</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-zinc-100 dark:divide-zinc-800">
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">ValueChanged</td>
                            <td class="py-3 px-4"><TypeBadge Type="EventCallback<TValue>" /></td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">Callback when value changes</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-zinc-900 dark:text-zinc-100">OnValidationChanged</td>
                            <td class="py-3 px-4"><TypeBadge Type="EventCallback<bool>" /></td>
                            <td class="py-3 px-4 text-zinc-600 dark:text-zinc-400">Callback when validation state changes</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Installation -->
    <section class="mb-12">
        <h2 class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4">Installation</h2>
        <p class="text-zinc-600 dark:text-zinc-400 mb-4">
            Install the ValidatedInput component using the Vibe.UI CLI:
        </p>
        <CodeBlock Code="vibe add validatedinput" Language="bash" />
    </section>

    <!-- Accessibility -->
    <section class="mb-12">
        <h2 class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4">Accessibility</h2>
        <div class="prose prose-zinc dark:prose-invert max-w-none">
            <ul class="space-y-2 text-zinc-600 dark:text-zinc-400">
                <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    ARIA attributes for validation states
                </li>
                <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    Error messages announced to screen readers
                </li>
                <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <code class="text-sm bg-zinc-100 dark:bg-zinc-800 px-1 py-0.5 rounded">aria-invalid</code> set when validation fails
                </li>
                <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <code class="text-sm bg-zinc-100 dark:bg-zinc-800 px-1 py-0.5 rounded">aria-describedby</code> links to error messages
                </li>
                <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    Focus management for validation errors
                </li>
            </ul>
        </div>
    </section>

    <!-- Related Components -->
    <section>
        <h2 class="text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-4">Related</h2>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <a href="/components/form" class="group p-4 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:border-brand-teal dark:hover:border-brand-teal transition-colors">
                <h4 class="font-medium text-zinc-900 dark:text-zinc-100 group-hover:text-brand-teal">Form</h4>
                <p class="text-sm text-zinc-500">Form container with validation</p>
            </a>
            <a href="/components/formfield" class="group p-4 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:border-brand-teal dark:hover:border-brand-teal transition-colors">
                <h4 class="font-medium text-zinc-900 dark:text-zinc-100 group-hover:text-brand-teal">FormField</h4>
                <p class="text-sm text-zinc-500">Form field wrapper</p>
            </a>
            <a href="/components/input" class="group p-4 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:border-brand-teal dark:hover:border-brand-teal transition-colors">
                <h4 class="font-medium text-zinc-900 dark:text-zinc-100 group-hover:text-brand-teal">Input</h4>
                <p class="text-sm text-zinc-500">Basic text input</p>
            </a>
        </div>
    </section>
</div>

@code {
    private string username = "";
    private string email = "";
    private string password = "";
    private string fullName = "";
    private string passwordStrength = "None";

    private string ValidateUsername(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            return "Username is required";
        if (value.Length < 3)
            return "Username must be at least 3 characters";
        if (!System.Text.RegularExpressions.Regex.IsMatch(value, "^[a-zA-Z0-9_]+$"))
            return "Only letters, numbers, and underscores allowed";
        return null;
    }

    private string ValidateEmail(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            return "Email is required";
        if (!value.Contains("@") || !value.Contains("."))
            return "Please enter a valid email address";
        return null;
    }

    private string ValidatePassword(string value)
    {
        if (string.IsNullOrEmpty(value))
        {
            passwordStrength = "None";
            return "Password is required";
        }

        if (value.Length < 8)
        {
            passwordStrength = "Weak";
            return "Password must be at least 8 characters";
        }

        var hasUpper = System.Text.RegularExpressions.Regex.IsMatch(value, "[A-Z]");
        var hasLower = System.Text.RegularExpressions.Regex.IsMatch(value, "[a-z]");
        var hasDigit = System.Text.RegularExpressions.Regex.IsMatch(value, "[0-9]");
        var hasSpecial = System.Text.RegularExpressions.Regex.IsMatch(value, "[^a-zA-Z0-9]");

        var score = (hasUpper ? 1 : 0) + (hasLower ? 1 : 0) + (hasDigit ? 1 : 0) + (hasSpecial ? 1 : 0);
        passwordStrength = score switch
        {
            1 or 2 => "Weak",
            3 => "Medium",
            4 => "Strong",
            _ => "Weak"
        };

        return null;
    }

    private string BasicCode => @"<EditForm Model=""@model"">
    <DataAnnotationsValidator />
    <ValidatedInput @bind-Value=""@model.Email""
                    For=""@(() => model.Email)""
                    Label=""Email"" />
</EditForm>";

    private string DataAnnotationsCode => @"<EditForm Model=""@model"" OnValidSubmit=""@HandleSubmit"">
    <DataAnnotationsValidator />

    <ValidatedInput @bind-Value=""@model.Name""
                    For=""@(() => model.Name)""
                    Label=""Name"" />

    <ValidatedInput @bind-Value=""@model.Email""
                    For=""@(() => model.Email)""
                    Label=""Email"" />

    <Button Type=""submit"">Submit</Button>
</EditForm>

@code {
    public class UserModel
    {
        [Required(ErrorMessage = ""Name is required"")]
        [StringLength(50, MinimumLength = 2)]
        public string Name { get; set; }

        [Required]
        [EmailAddress]
        public string Email { get; set; }
    }
}";

    private string CustomValidationCode => @"<ValidatedInput @bind-Value=""@username""
                Label=""Username""
                CustomValidator=""@ValidateUsername"" />

@code {
    private string username = """";

    private string ValidateUsername(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            return ""Username is required"";
        if (value.Length < 3)
            return ""Username must be at least 3 characters"";
        if (!Regex.IsMatch(value, ""^[a-zA-Z0-9_]+$""))
            return ""Username can only contain letters, numbers, and underscores"";
        return null; // Valid
    }
}";

    private string RealtimeCode => @"<ValidatedInput @bind-Value=""@password""
                Label=""Password""
                Type=""password""
                ValidationMode=""ValidationMode.OnChange""
                CustomValidator=""@ValidatePassword"" />

<p>Password strength: @passwordStrength</p>

@code {
    private string password = """";
    private string passwordStrength = ""Weak"";

    private string ValidatePassword(string value)
    {
        if (string.IsNullOrEmpty(value))
        {
            passwordStrength = ""None"";
            return ""Password is required"";
        }

        var strength = CalculatePasswordStrength(value);
        passwordStrength = strength;

        if (value.Length < 8)
            return ""Password must be at least 8 characters"";

        return null;
    }
}";

    private string MultipleValidatorsCode => @"<EditForm Model=""@model"">
    <DataAnnotationsValidator />
    <CustomValidator />

    <ValidatedInput @bind-Value=""@model.Username""
                    For=""@(() => model.Username)""
                    Label=""Username"" />
</EditForm>";
}
