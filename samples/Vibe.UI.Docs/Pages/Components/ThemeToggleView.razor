@page "/components/themetoggle"

<PageTitle>ThemeToggle - Vibe.UI</PageTitle>

<ComponentPage ComponentName="ThemeToggle"
               Category="Theme"
               Description="A simple, self-contained component for toggling between light and dark themes. No service registration required."
               RelatedComponents="@relatedComponents">

    <PreviewContent>
        <div class="preview-demo" style="display: flex; flex-direction: column; gap: 1.5rem; align-items: center;">
            <div style="display: flex; gap: 1rem; align-items: center;">
                <span>Toggle theme:</span>
                <ThemeToggle />
            </div>

            <Alert Variant="AlertVariant.Info">
                Click the toggle button above to switch between light and dark modes.
                The theme preference is saved to localStorage and persists across sessions.
            </Alert>

            <div style="padding: 1.5rem; border: 1px solid var(--vibe-border); border-radius: 8px; width: 100%; max-width: 400px; background: var(--vibe-card); color: var(--vibe-card-foreground);">
                <h4>Themed Card Example</h4>
                <p>This card automatically adapts to the selected theme using CSS variables.</p>
                <Button Variant="ButtonVariant.Primary">Primary Button</Button>
            </div>
        </div>
    </PreviewContent>

    <Examples>
        <Alert Variant="AlertVariant.Info" style="margin-bottom: 1.5rem;">
            <strong>No Service Registration Required!</strong>
            <br />
            Unlike the old ThemeManager system, ThemeToggle works completely standalone. Just add it to your page and it works.
        </Alert>

        <div class="example-item">
            <h3>Basic Usage</h3>
            <p>Just drop it in - no setup required!</p>
            <CodeBlock Code="@BasicCode" Language="razor" />
        </div>

        <div class="example-item">
            <h3>Features</h3>
            <ul>
                <li>âœ… <strong>Zero Dependencies</strong> - No service registration, no external libraries</li>
                <li>âœ… <strong>System Preference Detection</strong> - Automatically detects user's OS theme preference on first load</li>
                <li>âœ… <strong>localStorage Persistence</strong> - Remembers user choice across sessions</li>
                <li>âœ… <strong>Inline JavaScript</strong> - Uses minimal inline JS for theme detection and persistence</li>
                <li>âœ… <strong>Pure CSS Theming</strong> - Works by toggling .dark class on document element</li>
                <li>âœ… <strong>Self-Contained</strong> - Everything needed is in one component file</li>
            </ul>
        </div>

        <div class="example-item">
            <h3>In Navigation Bar</h3>
            <p>Commonly placed in the header alongside other actions:</p>
            <CodeBlock Code="@NavBarCode" Language="razor" />
        </div>

        <div class="example-item">
            <h3>Custom Storage Key</h3>
            <p>Use a custom localStorage key for theme preference:</p>
            <CodeBlock Code="@CustomStorageCode" Language="razor" />
        </div>

        <div class="example-item">
            <h3>How It Works Internally</h3>
            <p>The ThemeToggle component uses a simple, elegant approach:</p>
            <ol>
                <li>
                    <strong>On Initialization</strong> - Checks localStorage for saved preference, or falls back to system preference using <code>matchMedia('(prefers-color-scheme: dark)')</code>
                </li>
                <li>
                    <strong>On Toggle</strong> - Adds or removes the <code>.dark</code> class on <code>document.documentElement</code> (the <code>&lt;html&gt;</code> element)
                </li>
                <li>
                    <strong>Persistence</strong> - Saves the current theme to localStorage under the configured key
                </li>
                <li>
                    <strong>CSS Response</strong> - All components use CSS variables defined in <code>:root</code> (light) and <code>.dark</code> (dark) selectors
                </li>
            </ol>
            <CodeBlock Code="@HowItWorksCode" Language="csharp" />
        </div>

        <div class="example-item">
            <h3>Implementation Details</h3>
            <p>Here's how the component works internally:</p>
            <CodeBlock Code="@ImplementationCode" Language="csharp" />
        </div>

        <div class="example-item">
            <h3>Multiple Toggles</h3>
            <p>You can have multiple ThemeToggle components on the same page - they all stay in sync:</p>
            <CodeBlock Code="@MultipleCode" Language="razor" />
        </div>

        <Alert Variant="AlertVariant.Warning" style="margin-top: 1.5rem;">
            <strong>Breaking Change from v1.x</strong>
            <br />
            The old ThemeToggle that required ThemeManager service has been removed. The new version is simpler and more reliable.
        </Alert>
    </Examples>

    <Props>
        <table class="api-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Default</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>StorageKey</code></td>
                    <td>string</td>
                    <td>"vibe-theme"</td>
                    <td>localStorage key for persisting theme preference</td>
                </tr>
                <tr>
                    <td><code>Class</code></td>
                    <td>string</td>
                    <td>""</td>
                    <td>Additional CSS classes (inherited from VibeComponent)</td>
                </tr>
                <tr>
                    <td><code>AdditionalAttributes</code></td>
                    <td>Dictionary&lt;string, object&gt;</td>
                    <td>null</td>
                    <td>Additional HTML attributes (inherited from VibeComponent)</td>
                </tr>
            </tbody>
        </table>
    </Props>

    <AccessibilityNotes>
        <ul>
            <li>Uses semantic <code>&lt;button&gt;</code> element</li>
            <li>Includes descriptive button text with sun/moon icons</li>
            <li>Fully keyboard accessible (Enter/Space to toggle)</li>
            <li>Clear focus indicators via CSS</li>
            <li>Visual feedback on hover and active states</li>
        </ul>
    </AccessibilityNotes>
</ComponentPage>

@code {
    private List<string> relatedComponents = new() { "Button" };

    private string BasicCode => @"<!-- That's it! No service registration, no configuration. -->
<ThemeToggle />
";

    private string NavBarCode => @"<nav class=""navbar"">
    <div class=""navbar-brand"">
        <a href=""/"">My App</a>
    </div>

    <div class=""navbar-actions"">
        <button class=""notifications-btn"">ðŸ””</button>
        <ThemeToggle />
        <button class=""profile-btn"">ðŸ‘¤</button>
    </div>
</nav>
";

    private string CustomStorageCode => @"<!-- Use a custom localStorage key -->
<ThemeToggle StorageKey=""my-app-theme"" />
";

    private string HowItWorksCode => @"// On initialization
protected override async Task OnInitializedAsync()
{
    // Check localStorage or system preference
    _isDark = await JS.InvokeAsync<bool>(""eval"",
        $@""(function() {{
            const stored = localStorage.getItem('{StorageKey}');
            if (stored) return stored === 'dark';
            return window.matchMedia('(prefers-color-scheme: dark)').matches;
        }})()"");

    await ApplyTheme(false);
}

// On toggle
private async Task ToggleTheme()
{
    _isDark = !_isDark;
    await ApplyTheme(true);
}

// Apply theme to DOM and localStorage
private async Task ApplyTheme(bool stateChanged)
{
    var theme = _isDark ? ""dark"" : ""light"";
    await JS.InvokeVoidAsync(""eval"",
        $@""(function() {{
            if ('{theme}' === 'dark') {{
                document.documentElement.classList.add('dark');
            }} else {{
                document.documentElement.classList.remove('dark');
            }}
            localStorage.setItem('{StorageKey}', '{theme}');
        }})()"");

    if (stateChanged) StateHasChanged();
}";

    private string MultipleCode => @"<header>
    <ThemeToggle />
</header>

<main>
    <!-- Content here -->
</main>

<footer>
    <ThemeToggle />  <!-- Stays in sync with header toggle -->
</footer>
";

    private string ImplementationCode => @"@namespace Vibe.UI.Components
@inherits Base.VibeComponent
@inject IJSRuntime JS

<button type=""button"" class=""@CombinedClass"" @onclick=""ToggleTheme"">
    @if (_isDark)
    {
        <!-- Sun icon for ""switch to light"" -->
        <svg>...</svg>
    }
    else
    {
        <!-- Moon icon for ""switch to dark"" -->
        <svg>...</svg>
    }
</button>

@code {
    [Parameter]
    public string StorageKey { get; set; } = ""vibe-theme"";

    protected override string ComponentClass => ""vibe-theme-toggle"";

    private bool _isDark = false;

    protected override async Task OnInitializedAsync()
    {
        // Detect saved preference or system preference
        _isDark = await JS.InvokeAsync<bool>(""eval"",
            $@""(function() {{
                const stored = localStorage.getItem('{StorageKey}');
                if (stored) return stored === 'dark';
                return window.matchMedia('(prefers-color-scheme: dark)').matches;
            }})()"");
        await ApplyTheme(false);
    }

    private async Task ToggleTheme()
    {
        _isDark = !_isDark;
        await ApplyTheme(true);
    }

    private async Task ApplyTheme(bool stateChanged)
    {
        var theme = _isDark ? ""dark"" : ""light"";
        await JS.InvokeVoidAsync(""eval"",
            $@""(function() {{
                if ('{theme}' === 'dark') {{
                    document.documentElement.classList.add('dark');
                }} else {{
                    document.documentElement.classList.remove('dark');
                }}
                localStorage.setItem('{StorageKey}', '{theme}');
            }})()"");

        if (stateChanged) StateHasChanged();
    }
}";
}
