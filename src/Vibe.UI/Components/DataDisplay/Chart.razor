@namespace Vibe.UI.Components
@inherits ThemedComponentBase

<div @attributes="AdditionalAttributes" class="@CombinedCssClass">
    @if (!string.IsNullOrEmpty(Title))
    {
        <div class="vibe-chart-header">
            <h3 class="vibe-chart-title">@Title</h3>
            @if (!string.IsNullOrEmpty(Description))
            {
                <p class="vibe-chart-description">@Description</p>
            }
        </div>
    }

    <div class="vibe-chart-container">
        <canvas @ref="canvasRef" class="vibe-chart-canvas"></canvas>
    </div>

    @if (ShowLegend && ChartData?.Datasets?.Any() == true)
    {
        <div class="vibe-chart-legend">
            @foreach (var dataset in ChartData.Datasets)
            {
                <div class="vibe-chart-legend-item">
                    <span class="vibe-chart-legend-color" style="background-color: @dataset.Color;"></span>
                    <span class="vibe-chart-legend-label">@dataset.Label</span>
                </div>
            }
        </div>
    }

    @if (FooterContent != null)
    {
        <div class="vibe-chart-footer">
            @FooterContent
        </div>
    }
</div>

@code {
    private ElementReference canvasRef;

    /// <summary>
    /// The chart data to display.
    /// </summary>
    [Parameter, EditorRequired]
    public ChartData? ChartData { get; set; }

    /// <summary>
    /// The type of chart to render.
    /// </summary>
    [Parameter]
    public ChartType Type { get; set; } = ChartType.Line;

    /// <summary>
    /// The title of the chart.
    /// </summary>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// The description of the chart.
    /// </summary>
    [Parameter]
    public string? Description { get; set; }

    /// <summary>
    /// Whether to show the legend.
    /// </summary>
    [Parameter]
    public bool ShowLegend { get; set; } = true;

    /// <summary>
    /// Whether to show grid lines.
    /// </summary>
    [Parameter]
    public bool ShowGrid { get; set; } = true;

    /// <summary>
    /// The height of the chart in pixels.
    /// </summary>
    [Parameter]
    public int Height { get; set; } = 300;

    /// <summary>
    /// Chart configuration options.
    /// </summary>
    [Parameter]
    public ChartOptions? Options { get; set; }

    /// <summary>
    /// Footer content for the chart.
    /// </summary>
    [Parameter]
    public RenderFragment? FooterContent { get; set; }

    /// <summary>
    /// Additional CSS classes to apply.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string CombinedCssClass => CombineClasses(
        "vibe-chart",
        $"vibe-chart-{Type.ToString().ToLower()}",
        CssClass
    );

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && ChartData != null)
        {
            // In a real implementation, this would use JS interop to render
            // the chart using a library like Chart.js, ApexCharts, or similar
            // For now, this is a placeholder structure
            await Task.CompletedTask;
        }
    }
}

public class ChartData
{
    public List<string> Labels { get; set; } = new();
    public List<ChartDataset> Datasets { get; set; } = new();
}

public class ChartDataset
{
    public string Label { get; set; } = string.Empty;
    public List<double> Data { get; set; } = new();
    public string Color { get; set; } = "#3b82f6";
    public string? BackgroundColor { get; set; }
    public string? BorderColor { get; set; }
    public int BorderWidth { get; set; } = 2;
    public bool Fill { get; set; }
}

public class ChartOptions
{
    public bool Responsive { get; set; } = true;
    public bool MaintainAspectRatio { get; set; } = true;
    public ChartAnimation? Animation { get; set; }
    public ChartTooltip? Tooltip { get; set; }
}

public class ChartAnimation
{
    public int Duration { get; set; } = 400;
    public string Easing { get; set; } = "easeInOutQuart";
}

public class ChartTooltip
{
    public bool Enabled { get; set; } = true;
    public string Mode { get; set; } = "index";
    public bool Intersect { get; set; } = false;
}

public enum ChartType
{
    Line,
    Bar,
    Pie,
    Doughnut,
    Radar,
    PolarArea,
    Area
}
