@namespace Vibe.UI.Components
@inherits Vibe.UI.Base.VibeComponent
@inject NavigationManager NavigationManager

@if (Disabled)
{
    <span class="@CombinedClass @VariantClass @UnderlineClass vibe-link-disabled" aria-disabled="true" @attributes="AdditionalAttributes">
        @ChildContent
    </span>
}
else if (!string.IsNullOrEmpty(Href))
{
    @if (IsExternal)
    {
        <a href="@Href" target="@Target" rel="@Rel" class="@CombinedClass @VariantClass @UnderlineClass" @onclick="HandleClick" @attributes="AdditionalAttributes">
            @ChildContent
        </a>
    }
    else
    {
        <a href="@Href" class="@CombinedClass @VariantClass @UnderlineClass" @onclick="HandleClick" @attributes="AdditionalAttributes">
            @ChildContent
        </a>
    }
}
else
{
    <button type="button" class="@CombinedClass @VariantClass @UnderlineClass vibe-link-button" @onclick="HandleClick" @attributes="AdditionalAttributes">
        @ChildContent
    </button>
}

@code {
    /// <summary>
    /// Gets or sets the child content
    /// </summary>
    [Parameter]
    public RenderFragment ChildContent { get; set; }

    /// <summary>
    /// Gets or sets the URL to navigate to
    /// </summary>
    [Parameter]
    public string? Href { get; set; }

    /// <summary>
    /// Gets or sets the target attribute
    /// </summary>
    [Parameter]
    public string? Target { get; set; }

    /// <summary>
    /// Gets or sets the visual style variant
    /// </summary>
    [Parameter]
    public LinkVariant Variant { get; set; } = LinkVariant.Default;

    /// <summary>
    /// Gets or sets the underline behavior
    /// </summary>
    [Parameter]
    public LinkUnderline Underline { get; set; } = LinkUnderline.Hover;

    /// <summary>
    /// Gets or sets whether the link is disabled
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Gets or sets the click event callback
    /// </summary>
    [Parameter]
    public EventCallback<MouseEventArgs> OnClick { get; set; }

    /// <inheritdoc/>
    protected override string ComponentClass => "vibe-link";

    private bool IsExternal => !string.IsNullOrEmpty(Href) && (Href.StartsWith("http://") || Href.StartsWith("https://") || Href.StartsWith("//"));

    private string Rel => IsExternal && Target == "_blank" ? "noopener noreferrer" : string.Empty;

    private string VariantClass => Variant switch
    {
        LinkVariant.Primary => "vibe-link-primary",
        LinkVariant.Secondary => "vibe-link-secondary",
        LinkVariant.Muted => "vibe-link-muted",
        _ => ""
    };

    private string UnderlineClass => Underline switch
    {
        LinkUnderline.Always => "vibe-link-underline-always",
        LinkUnderline.Hover => "vibe-link-underline-hover",
        LinkUnderline.None => "vibe-link-underline-none",
        _ => "vibe-link-underline-hover"
    };

    private async Task HandleClick(MouseEventArgs e)
    {
        if (!Disabled && OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync(e);
        }
    }

    public enum LinkVariant
    {
        Default,
        Primary,
        Secondary,
        Muted
    }

    public enum LinkUnderline
    {
        Always,
        Hover,
        None
    }
}
