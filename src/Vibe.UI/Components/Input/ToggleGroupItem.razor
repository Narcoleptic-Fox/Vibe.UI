@namespace Vibe.UI.Components
@inherits ThemedComponentBase

<button type="button"
        @attributes="AdditionalAttributes"
        class="@CombinedCssClass"
        disabled="@IsDisabled"
        aria-pressed="@IsPressed.ToString().ToLower()"
        @onclick="HandleClick">
    @ChildContent
</button>

@code {
    /// <summary>
    /// The content of the toggle item.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// The value of this toggle item.
    /// </summary>
    [Parameter, EditorRequired]
    public string Value { get; set; } = string.Empty;

    /// <summary>
    /// Whether this item is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Additional CSS classes to apply.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    [CascadingParameter]
    private ToggleGroup? Parent { get; set; }

    private bool IsPressed => Parent?.IsSelected(Value) ?? false;
    private bool IsDisabled => Disabled || (Parent?.Disabled ?? false);

    private string CombinedCssClass => CombineClasses(
        "vibe-toggle-group-item",
        IsPressed ? "vibe-toggle-group-item-pressed" : null,
        IsDisabled ? "vibe-toggle-group-item-disabled" : null,
        CssClass
    );

    protected override string ComponentClass => CombinedCssClass;

    private async Task HandleClick()
    {
        if (Parent != null && !IsDisabled)
        {
            await Parent.HandleItemToggle(Value);
        }
    }
}
