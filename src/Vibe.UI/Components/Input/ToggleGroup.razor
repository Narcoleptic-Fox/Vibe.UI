@namespace Vibe.UI.Components
@inherits ThemedComponentBase

<div @attributes="AdditionalAttributes" class="@CombinedCssClass" role="group" aria-label="@AriaLabel">
    <CascadingValue Value="this">
        @ChildContent
    </CascadingValue>
</div>

@code {
    /// <summary>
    /// The content of the toggle group (ToggleGroupItem components).
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// The type of toggle group (single or multiple selection).
    /// </summary>
    [Parameter]
    public ToggleGroupType Type { get; set; } = ToggleGroupType.Single;

    /// <summary>
    /// The currently selected value (for single selection).
    /// </summary>
    [Parameter]
    public string? Value { get; set; }

    /// <summary>
    /// The currently selected values (for multiple selection).
    /// </summary>
    [Parameter]
    public List<string> Values { get; set; } = new();

    /// <summary>
    /// Event callback when the value changes.
    /// </summary>
    [Parameter]
    public EventCallback<string?> ValueChanged { get; set; }

    /// <summary>
    /// Event callback when the values change (for multiple selection).
    /// </summary>
    [Parameter]
    public EventCallback<List<string>> ValuesChanged { get; set; }

    /// <summary>
    /// Whether the toggle group is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// The orientation of the toggle group.
    /// </summary>
    [Parameter]
    public ToggleGroupOrientation Orientation { get; set; } = ToggleGroupOrientation.Horizontal;

    /// <summary>
    /// The size variant of the toggle group.
    /// </summary>
    [Parameter]
    public ToggleGroupSize Size { get; set; } = ToggleGroupSize.Default;

    /// <summary>
    /// Accessible label for the toggle group.
    /// </summary>
    [Parameter]
    public string? AriaLabel { get; set; }

    /// <summary>
    /// Additional CSS classes to apply.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    private string CombinedCssClass => CombineClasses(
        "vibe-toggle-group",
        $"vibe-toggle-group-{Orientation.ToString().ToLower()}",
        $"vibe-toggle-group-{Size.ToString().ToLower()}",
        Disabled ? "vibe-toggle-group-disabled" : null,
        CssClass
    );

    protected override string ComponentClass => CombinedCssClass;

    internal async Task HandleItemToggle(string itemValue)
    {
        if (Disabled) return;

        if (Type == ToggleGroupType.Single)
        {
            // Single selection: toggle off if same, otherwise set new value
            var newValue = Value == itemValue ? null : itemValue;
            Value = newValue;
            await ValueChanged.InvokeAsync(newValue);
        }
        else
        {
            // Multiple selection: add/remove from list
            if (Values.Contains(itemValue))
            {
                Values.Remove(itemValue);
            }
            else
            {
                Values.Add(itemValue);
            }
            await ValuesChanged.InvokeAsync(Values);
        }
    }

    internal bool IsSelected(string itemValue)
    {
        return Type == ToggleGroupType.Single
            ? Value == itemValue
            : Values.Contains(itemValue);
    }

    public enum ToggleGroupType
    {
        Single,
        Multiple
    }

    public enum ToggleGroupOrientation
    {
        Horizontal,
        Vertical
    }

    public enum ToggleGroupSize
    {
        Small,
        Default,
        Large
    }
}
