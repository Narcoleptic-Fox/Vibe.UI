@namespace Vibe.UI.Components
@inherits Vibe.UI.Base.VibeComponent
@using Vibe.UI.Enums

@if (Href != null)
{
    @* Note: disabled attribute doesn't work on anchors, so we use aria-disabled + pointer-events: none in CSS + click prevention *@
    <a href="@(Disabled || Loading ? null : Href)"
        class="@CombinedClass @(Disabled ? "vibe-button-disabled" : "")"
        target="@Target"
        rel="@RelAttribute"
        aria-disabled="@(Disabled || Loading ? "true" : null)"
        tabindex="@(Disabled || Loading ? -1 : 0)"
        @attributes="AdditionalAttributes"
        @onclick="OnClickHandler"
        @onclick:preventDefault="@(Disabled || Loading)">
        @if (Loading)
        {
            <span class="vibe-button-spinner"></span>
        }
        @if (Icon != null)
        {
            <span class="vibe-button-icon">@Icon</span>
        }
        @if (ChildContent != null)
        {
            <span class="vibe-button-content">@ChildContent</span>
        }
    </a>
}
else
{
    <button type="@Type" class="@CombinedClass" disabled="@Disabled" @attributes="AdditionalAttributes"
        @onclick="OnClickHandler">
        @if (Loading)
        {
            <span class="vibe-button-spinner"></span>
        }
        @if (Icon != null)
        {
            <span class="vibe-button-icon">@Icon</span>
        }
        @if (ChildContent != null)
        {
            <span class="vibe-button-content">@ChildContent</span>
        }
    </button>
}

@code {
    /// <summary>
    /// Gets or sets the button content
    /// </summary>
    [Parameter]
    public RenderFragment ChildContent { get; set; }

    /// <summary>
    /// Gets or sets the button icon
    /// </summary>
    [Parameter]
    public RenderFragment Icon { get; set; }

    /// <summary>
    /// Gets or sets the button variant style.
    /// Determines the visual appearance and hierarchy of the button.
    /// </summary>
    [Parameter]
    public ButtonVariant Variant { get; set; } = ButtonVariant.Primary;

    /// <summary>
    /// Gets or sets the button size.
    /// Controls the button's dimensions and padding.
    /// </summary>
    [Parameter]
    public ComponentSize Size { get; set; } = ComponentSize.Medium;

    /// <summary>
    /// Gets or sets whether the button is full width
    /// </summary>
    [Parameter]
    public bool FullWidth { get; set; }

    /// <summary>
    /// Gets or sets whether the button is disabled
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Gets or sets whether the button is in a loading state
    /// </summary>
    [Parameter]
    public bool Loading { get; set; }

    /// <summary>
    /// Gets or sets the button type (submit, reset, button)
    /// </summary>
    [Parameter]
    public string Type { get; set; } = "button";

    /// <summary>
    /// Gets or sets the URL to navigate to when the button is clicked
    /// When provided, the button is rendered as an anchor tag
    /// </summary>
    [Parameter]
    public string Href { get; set; }

    /// <summary>
    /// Gets or sets the target attribute for the anchor tag
    /// Only applicable when Href is provided
    /// </summary>
    [Parameter]
    public string Target { get; set; }

    /// <summary>
    /// Gets or sets the rel attribute for the anchor tag
    /// Only applicable when Href is provided
    /// </summary>
    [Parameter]
    public string Rel { get; set; }

    /// <summary>
    /// Gets or sets the callback for when the button is clicked
    /// </summary>
    [Parameter]
    public EventCallback<MouseEventArgs> OnClick { get; set; }

    /// <inheritdoc/>
    protected override string ComponentClass => new ClassBuilder()
        .Add("vibe-button")
        .AddVariant("vibe-button", Variant)
        .AddVariant("vibe-button", Size)
        .AddIf("vibe-button-full-width", FullWidth)
        .AddIf("vibe-button-loading", Loading)
        .AddWhen("vibe-button-icon-only", () => Icon != null && ChildContent == null)
        .Build();

    /// <summary>
    /// Gets the rel attribute value
    /// </summary>
    private string RelAttribute => string.IsNullOrEmpty(Target) ? Rel : "noopener noreferrer";

    private async Task OnClickHandler(MouseEventArgs args)
    {
        if (!Disabled && !Loading && OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync(args);
        }
    }
}